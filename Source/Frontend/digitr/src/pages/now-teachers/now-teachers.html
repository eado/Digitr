<!--
  Generated template for the NowTeachersPage page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>
  <ion-toolbar>
      <ion-buttons start>
          <button ion-button (click)="signout()">
            Sign Out
          </button>
        </ion-buttons>
    <ion-segment [(ngModel)]="currentPage">
      <ion-segment-button value="messages">
        Messages
      </ion-segment-button>
      <ion-segment-button value="analytics">
        Analytics
      </ion-segment-button>
    </ion-segment>
    <ion-buttons end>
      <a target="_new" href="https://mpassapp.com">
        <button ion-button icon-only>
          <ion-icon name="help-circle"></ion-icon>
        </button>
      </a>
    </ion-buttons>
  </ion-toolbar>
</ion-header>


<ion-content>
  <div *ngIf="currentPage == 'messages' && user">
    <div *ngIf="user.messages.length < 1">
      <h1 class="nohistory">No messages</h1>
    </div>
    <ion-list *ngFor="let message of user.messages" [ngSwitch]="message.type">
      <ion-list-header>{{ message.user }}</ion-list-header>
      <ion-item text-wrap *ngSwitchCase="'pass_request'">
        <b>{{ message.title }}: </b>{{ message.subTitle }}
        <ion-note item-end color="dark"></ion-note>
        <ion-note item-end>
          <button icon-end ion-button small color="secondary" (click)="approve(message.timestamp)">
            Approve
            <ion-icon name="checkmark-circle"></ion-icon>
          </button>
        </ion-note>
        <ion-note item-end>
          <button icon-end ion-button small color="danger" (click)="deny(message.timestamp, message.email)">
            Deny
            <ion-icon name="remove-circle"></ion-icon>
          </button>
        </ion-note>
      </ion-item>
      <ion-item text-wrap *ngSwitchCase="pass_done">
          <b>{{ message.title }}: </b>{{ message.subTitle }}{{ playSound() }}
          <ion-note item-end><button ion-button small (click)="dismiss(message.timestamp)">Dismiss</button></ion-note>
      </ion-item>
      <ion-item text-wrap *ngSwitchDefault>
        <b>{{ message.title }}: </b>{{ message.subTitle }}
        <ion-note item-end><button ion-button small (click)="dismiss(message.timestamp)">Dismiss</button></ion-note>
      </ion-item>
    </ion-list>
  </div>
  <div *ngIf="currentPage == 'analytics'">
      <h1 class="nohistory" *ngIf="!analytics">Analytics is not enabled by your administrator.</h1>
      <div *ngIf="analytics">
        <div *ngIf="analyticsPage == 'stats'">
          <ion-grid>
            <ion-row>
              <div col-md-6 col-12>
                <ion-card color="dark">
                  <ion-card-header>
                    Free passes approved 
                  </ion-card-header>
                  <ion-card-content>
                      <h1>{{ stats.freePasses }}</h1>
                  </ion-card-content>
                </ion-card>
              </div>
              <div col-md-6 col-12>
                <ion-card color="primary">
                  <ion-card-header>
                    Regular passes approved 
                  </ion-card-header>
                  <ion-card-content>
                      <h1>{{ stats.regularPasses }}</h1>
                  </ion-card-content>
                </ion-card>
              </div>
              <div col-md-6 col-12>
                <ion-card color="light">
                  <ion-card-header>
                    Total number of passes approved
                  </ion-card-header>
                  <ion-card-content>
                      <h1>{{ stats.passesIssued }}</h1>
                  </ion-card-content>
                </ion-card>
              </div>
              <div col-md-6 col-12>
                <ion-card color="dark">
                  <ion-card-header>
                    Average amount of time approved
                  </ion-card-header>
                  <ion-card-content>
                      <h1>{{ stats.avgMinutes }} minutes</h1>
                  </ion-card-content>
                </ion-card>
              </div>
              <div col-md-6 col-12>
                <ion-card color="primary">
                  <ion-card-header>
                    Average time spent
                  </ion-card-header>
                  <ion-card-content>
                      <h1>{{ stats.avgInterval }}</h1>
                  </ion-card-content>
                </ion-card>
              </div>
              <div col-md-6 col-12>
                <ion-card color="light">
                  <ion-card-header>
                    Most Valuable Player (student who used the most passes)
                  </ion-card-header>
                  <ion-card-content>
                      <h1>{{ stats.mvp }}</h1>
                  </ion-card-content>
                </ion-card>
              </div>
              <div col-md-6 col-12>
                <ion-card color="dark">
                  <ion-card-header>
                    Currently Out
                  </ion-card-header>
                  <ion-card-content>
                      <h1>{{ stats.currentlyOut }}</h1>
                      <h1 *ngIf="stats.currentlyOut.length < 1">Nobody</h1>
                  </ion-card-content>
                </ion-card>
              </div>
            </ion-row>
          </ion-grid>
        </div>
        <div *ngIf="analyticsPage == 'search'">
            <ion-searchbar (ionInput)="getItems($event)"></ion-searchbar>
            <ion-list>
              <ion-item (click)="getUser(user)" *ngFor="let user of filteredStudents">{{ user }}<ion-note item-end><ion-icon  name="arrow-forward"></ion-icon></ion-note></ion-item>
            </ion-list>
        </div>
      </div>
  </div>
  
</ion-content>
<div *ngIf="currentPage == 'analytics'">
  <div *ngIf="analytics">
      <ion-footer>
          <ion-toolbar>
            <ion-buttons start>
              <button ion-button (click)="getCSV()">Get CSV</button>
            </ion-buttons>
            <ion-segment [(ngModel)]="analyticsPage">
              <ion-segment-button value="stats">
                Stats
              </ion-segment-button>
              <ion-segment-button value="search">
                Search User
              </ion-segment-button>
            </ion-segment>
          </ion-toolbar>
        </ion-footer>
  </div>
</div>
